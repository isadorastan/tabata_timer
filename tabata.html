<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="tabata.css">
  <title>Tabata</title>
</head>

<body>
  <div id="container">
    <div class="timer">
      <h1 id="min">00</h1>
      <h1>:</h1>
      <h1 id="sec">00</h1>
    </div>
    <div class="info">
      <div id="status"></div>
      <div id="rounds"></div>
    </div>

    <div class="actions">
      <button id="start">Start</button>
      <button id="reset">Reset</button>
    </div>

    <div class="configurations">

      <label>Active duration:</label>
      <div class="active-duration">
        <button id="subActiveDuration">-</button>
        <p>
          <span id="activeMin">00</span><span>:</span><span id="activeSec">10</span>
        </p>
        <button id="addActiveDuration">+</button>
      </div>
    </div>
  </div>


  <script>
    // pegar os elementos
    const minEl = document.getElementById('min');
    const secEl = document.getElementById('sec');

    const activeDurationMinEl = document.getElementById('activeMin');
    const activeDurationSecEl = document.getElementById('activeSec');

    const container = document.getElementById('container');

    const statusEl = document.getElementById('status');
    const roundsEl = document.getElementById('rounds');

    const startButton = document.getElementById('start');
    startButton.addEventListener('click', startCounter);
    const resetButton = document.getElementById('reset');
    resetButton.addEventListener('click', resetCounter);
    const addActiveDurationButton = document.getElementById('addActiveDuration');
    addActiveDurationButton.addEventListener('click', addActiveDuration);
    const subActiveDurationButton = document.getElementById('subActiveDuration');
    subActiveDurationButton.addEventListener('click', subActiveDuration);

    let DEFAULT_MINUTES = 0;
    let DEFAULT_SECONDS = 10;
    const DEFAULT_REST_MINUTES = 0;
    const DEFAULT_REST_SECONDS = 5;
    const DEFAULT_ROUNDS = 8;

    let interval = null;
    let round = 1;
    let isActive = true;

    fillHtmlSecAndMin(DEFAULT_MINUTES, DEFAULT_SECONDS);

    function resetCounter() {
      fillHtmlSecAndMin(DEFAULT_MINUTES, DEFAULT_SECONDS);
      clearInterval(interval);
      roundsEl.innerHTML = '';
      statusEl.innerHTML = '';
      container.classList = '';
    }

    function handleNextRound() {

      console.log('NEXT ROUND');
      isActive = !isActive;
      container.classList = '';

      if (round >= DEFAULT_ROUNDS) {
        statusEl.innerHTML = 'ACABOU âœŒðŸ¼'
        return
      };

      isActive ? container.classList.add('active') : container.classList.add('rest');

      // handle rounds
      if (isActive) round++;
      roundsEl.innerHTML = `ROUND ${round}/${DEFAULT_ROUNDS}`

      statusEl.innerHTML = isActive ? 'ATIVO' : 'REST';
      isActive ? setNewInterval(DEFAULT_MINUTES, DEFAULT_SECONDS) : setNewInterval(DEFAULT_REST_MINUTES, DEFAULT_REST_SECONDS);
    }

    function startCounter() {
      round = 1;
      isActive = true;
      statusEl.innerHTML = 'ATIVO';
      container.classList.add('active');
      roundsEl.innerHTML = `ROUND ${round}/${DEFAULT_ROUNDS}`
      setNewInterval(DEFAULT_MINUTES, DEFAULT_SECONDS);
    }

    function setNewInterval(min, sec) {
      let seconds = sec;
      let minutes = min;
      fillHtmlSecAndMin(min, sec);

      interval = setInterval(() => {

        if (!seconds && !minutes) {
          console.log('TERMINOU');
          clearInterval(interval);
          handleNextRound();
          return;
        }

        if (!seconds && minutes) {
          minutes--;
          seconds = 60;
        }

        seconds--;
        fillHtmlSecAndMin(minutes, seconds)

      }, 1000);
    }

    function fillHtmlSecAndMin(min, sec) {
      secEl.innerHTML = sec < 10 ? `0${sec}` : sec;
      minEl.innerHTML = min < 10 ? `0${min}` : min;
    }

    function subActiveDuration() {
      if (!DEFAULT_SECONDS) {
        if (!DEFAULT_MINUTES) return;
        DEFAULT_MINUTES--;
        DEFAULT_SECONDS = 50;
        updateDefaultTimeInHtml();
        return;
      }

      DEFAULT_SECONDS -= 10;
      updateDefaultTimeInHtml();
    }

    function addActiveDuration() {
      if (DEFAULT_SECONDS === 50) {
        DEFAULT_MINUTES += 1;
        DEFAULT_SECONDS = 0
        updateDefaultTimeInHtml();
        return;
      }

      DEFAULT_SECONDS += 10;
      updateDefaultTimeInHtml();
    }

    function updateDefaultTimeInHtml() {
      const sec = DEFAULT_SECONDS;
      const min = DEFAULT_MINUTES;
      activeDurationSecEl.innerHTML = sec < 10 ? `0${sec}` : sec;
      activeDurationMinEl.innerHTML = min < 10 ? `0${min}` : min;

      fillHtmlSecAndMin(DEFAULT_MINUTES, DEFAULT_SECONDS);
    }

  </script>
</body>

</html>